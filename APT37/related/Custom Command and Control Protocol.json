{"title": "Custom Command and Control Protocol", "descrption": "\nAdversaries may communicate using a custom command and control protocol instead of encapsulating commands/data in an existing Standard Application Layer Protocol. Implementations include mimicking well-known protocols or developing custom protocols (including raw sockets) on top of fundamental protocols provided by TCP/IP/another standard network stack.\n", "ID": "T1094", "Tactic": "Command And Control", "Platform": "Linux, macOS, Windows", "Data Sources": "Packet capture, Netflow/Enclave netflow, Process use of network, Process monitoring, Host network interface, Network intrusion detection system, Network protocol analysis", "Requires Network": "Yes", "Contributors": "Ryan Becwar", "Version": "1.0", "Created": "31 May 2017", "Last Modified": "17 July 2019", "references": [{"index": 1, "title": "Gardiner, J.,  Cova, M., Nagaraja, S. (2014, February). Command & Control Understanding, Denying and Detecting. Retrieved April 20, 2016.", "external_link": "https://arxiv.org/ftp/arxiv/papers/1408/1408.1136.pdf"}, {"index": 2, "title": "Strategic Cyber LLC. (2017, March 14). Cobalt Strike Manual. Retrieved May 24, 2017.", "external_link": "https://cobaltstrike.com/downloads/csmanual38.pdf"}, {"index": 3, "title": "Mudge, R. (2014, July 14). Github Malleable-C2-Profiles safebrowsing.profile. Retrieved June 18, 2017.", "external_link": "https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/safebrowsing.profile"}, {"index": 4, "title": "Windows Defender Advanced Threat Hunting Team. (2016, April 29). PLATINUM: Targeted attacks in South and Southeast Asia. Retrieved February 15, 2018.", "external_link": "https://download.microsoft.com/download/2/2/5/225BFE3E-E1DE-4F5B-A77B-71200928D209/Platinum%20feature%20article%20-%20Targeted%20attacks%20in%20South%20and%20Southeast%20Asia%20April%202016.pdf"}, {"index": 5, "title": "Symantec Security Response. (2011, November). W32.Duqu: The precursor to the next Stuxnet. Retrieved September 17, 2015.", "external_link": "https://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/w32_duqu_the_precursor_to_the_next_stuxnet.pdf"}, {"index": 6, "title": "Ash, B., et al. (2018, June 26). RANCOR: Targeted Attacks in South East Asia Using PLAINTEE and DDKONG Malware Families. Retrieved July 2, 2018.", "external_link": "https://researchcenter.paloaltonetworks.com/2018/06/unit42-rancor-targeted-attacks-south-east-asia-using-plaintee-ddkong-malware-families/"}, {"index": 7, "title": "FireEye iSIGHT Intelligence. (2017, April 6). APT10 (MenuPass Group): New Tools, Global Campaign Latest Manifestation of Longstanding Threat. Retrieved June 29, 2017.", "external_link": "https://www.fireeye.com/blog/threat-research/2017/04/apt10_menupass_grou.html"}, {"index": 8, "title": "Neville, A. (2012, June 15). Trojan.Naid. Retrieved February 22, 2018.", "external_link": "https://www.symantec.com/security_response/writeup.jsp?docid=2012-061518-4639-99"}, {"index": 9, "title": "Symantec Security Response. (2012, June 18). CVE-2012-1875 Exploited in the Wild - Part 1 (Trojan.Naid). Retrieved February 22, 2018.", "external_link": "https://www.symantec.com/connect/blogs/cve-2012-1875-exploited-wild-part-1-trojannaid"}, {"index": 10, "title": "US-CERT. (2017, November 22). Alert (TA17-318B): HIDDEN COBRA \u2013 North Korean Trojan: Volgmer. Retrieved December 7, 2017.", "external_link": "https://www.us-cert.gov/ncas/alerts/TA17-318B"}, {"index": 11, "title": "US-CERT. (2017, November 01). Malware Analysis Report (MAR) - 10135536-D. Retrieved July 16, 2018.", "external_link": "https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_S508C.PDF"}, {"index": 12, "title": "Miller-Osborn, J. and Grunzweig, J.. (2017, March 30). Trochilus and New MoonWind RATs Used In Attack Against Thai Organizations. Retrieved March 30, 2017.", "external_link": "http://researchcenter.paloaltonetworks.com/2017/03/unit42-trochilus-rat-new-moonwind-rat-used-attack-thai-utility-organizations/"}, {"index": 13, "title": "Symantec Security Response. (2016, August 8). Backdoor.Remsec indicators of compromise. Retrieved August 17, 2016.", "external_link": "http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Symantec_Remsec_IOCs.pdf"}, {"index": 14, "title": "Kaspersky Lab's Global Research & Analysis Team. (2016, August 9). The ProjectSauron APT. Retrieved August 17, 2016.", "external_link": "https://securelist.com/files/2016/07/The-ProjectSauron-APT_research_KL.pdf"}, {"index": 15, "title": "Hayashi, K. (2017, November 28). UBoatRAT Navigates East Asia. Retrieved January 12, 2018.", "external_link": "https://researchcenter.paloaltonetworks.com/2017/11/unit42-uboatrat-navigates-east-asia/"}, {"index": 16, "title": "Sebastian Feldmann. (2018, February 14). Chaos: a Stolen Backdoor Rising Again. Retrieved March 5, 2018.", "external_link": "http://gosecure.net/2018/02/14/chaos-stolen-backdoor-rising/"}, {"index": 17, "title": "Hromcov\u00e1, Z. (2018, June 07). InvisiMole: Surprisingly equipped spyware, undercover since 2013. Retrieved July 10, 2018.", "external_link": "https://www.welivesecurity.com/2018/06/07/invisimole-equipped-spyware-undercover/"}, {"index": 18, "title": "Grunzweig, J. and Miller-Osborn, J. (2017, November 10). New Malware with Ties to SunOrcal Discovered. Retrieved November 16, 2017.", "external_link": "https://researchcenter.paloaltonetworks.com/2017/11/unit42-new-malware-with-ties-to-sunorcal-discovered/"}, {"index": 19, "title": "Lee, B., Falcone, R. (2018, June 06). Sofacy Group\u2019s Parallel Attacks. Retrieved June 18, 2018.", "external_link": "https://researchcenter.paloaltonetworks.com/2018/06/unit42-sofacy-groups-parallel-attacks/"}, {"index": 20, "title": "Gross, J. (2016, February 23). Operation Dust Storm. Retrieved September 19, 2017.", "external_link": "https://www.cylance.com/content/dam/cylance/pdfs/reports/Op_Dust_Storm_Report.pdf"}, {"index": 21, "title": "US-CERT. (2018, June 14). MAR-10135536-12 \u2013 North Korean Trojan: TYPEFRAME. Retrieved July 13, 2018.", "external_link": "https://www.us-cert.gov/ncas/analysis-reports/AR18-165A"}, {"index": 22, "title": "Fidelis Cybersecurity. (2016, February 29). The Turbo Campaign, Featuring Derusbi for 64-bit Linux. Retrieved March 2, 2016.", "external_link": "https://paper.seebug.org/papers/APT/APT_CyberCriminal_Campagin/2016/2016.02.29.Turbo_Campaign_Derusbi/TA_Fidelis_Turbo_1602_0.pdf"}, {"index": 23, "title": "Kaspersky Lab's Global Research and Analysis Team. (2014, November 24). THE REGIN PLATFORM NATION-STATE OWNAGE OF GSM NETWORKS. Retrieved December 1, 2014.", "external_link": "https://securelist.com/files/2014/11/Kaspersky_Lab_whitepaper_Regin_platform_eng.pdf"}, {"index": 24, "title": "Carr, N.. (2017, May 14). Cyber Espionage is Alive and Well: APT32 and the Threat to Global Corporations. Retrieved June 18, 2017.", "external_link": "https://www.fireeye.com/blog/threat-research/2017/05/cyber-espionage-apt32.html"}, {"index": 25, "title": "FireEye Labs. (2015, April). APT30 AND THE MECHANICS OF A LONG-RUNNING CYBER ESPIONAGE OPERATION. Retrieved May 1, 2015.", "external_link": "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"}, {"index": 26, "title": "Huss, D.. (2016, March 1). Operation Transparent Tribe. Retrieved June 8, 2016.", "external_link": "https://www.proofpoint.com/sites/default/files/proofpoint-operation-transparent-tribe-threat-insight-en.pdf"}, {"index": 27, "title": "Faou, M. and Boutin, J.. (2017, February). Read The Manual: A Guide to the RTM Banking Trojan. Retrieved March 9, 2017.", "external_link": "https://www.welivesecurity.com/wp-content/uploads/2017/02/Read-The-Manual.pdf"}, {"index": 28, "title": "Dell SecureWorks Counter Threat Unit Threat Intelligence. (2015, August 5). Threat Group-3390 Targets Organizations for Cyberespionage. Retrieved August 18, 2018.", "external_link": "https://www.secureworks.com/research/threat-group-3390-targets-organizations-for-cyberespionage"}, {"index": 29, "title": "Falcone, R., et al. (2018, July 27). New Threat Actor Group DarkHydrus Targets Middle East Government. Retrieved August 2, 2018.", "external_link": "https://researchcenter.paloaltonetworks.com/2018/07/unit42-new-threat-actor-group-darkhydrus-targets-middle-east-government/"}, {"index": 30, "title": "Lee, B., Falcone, R. (2019, January 18). DarkHydrus delivers new Trojan that can use Google Drive for C2 communications. Retrieved April 17, 2019.", "external_link": "https://unit42.paloaltonetworks.com/darkhydrus-delivers-new-trojan-that-can-use-google-drive-for-c2-communications/"}, {"index": 31, "title": "Bennett, J., Vengerik, B. (2017, June 12). Behind the CARBANAK Backdoor. Retrieved June 11, 2018.", "external_link": "https://www.fireeye.com/blog/threat-research/2017/06/behind-the-carbanak-backdoor.html"}, {"index": 32, "title": "Mandiant. (n.d.). Appendix C (Digital) - The Malware Arsenal. Retrieved July 18, 2016.", "external_link": "https://www.fireeye.com/content/dam/fireeye-www/services/pdfs/mandiant-apt1-report-appendix.zip"}, {"index": 33, "title": "Brandt, A.. (2019, May 5). Emotet 101, stage 4: command and control. Retrieved April 16, 2019.", "external_link": "https://news.sophos.com/en-us/2019/03/05/emotet-101-stage-4-command-and-control/"}, {"index": 34, "title": "Manea, D.. (2019, May 25). Emotet v4 Analysis. Retrieved April 16, 2019.", "external_link": "https://danielmanea.com/category/reverseengineering/"}, {"index": 35, "title": "Schwarz, D. and Proofpoint Staff. (2019, January 9). ServHelper and FlawedGrace - New malware introduced by TA505. Retrieved May 28, 2019.", "external_link": "https://www.proofpoint.com/us/threat-insight/post/servhelper-and-flawedgrace-new-malware-introduced-ta505"}, {"index": 36, "title": "Fidelis Cybersecurity. (2013, June 28). Fidelis Threat Advisory #1009: \"njRAT\" Uncovered. Retrieved June 4, 2019.", "external_link": "https://www.threatminer.org/_reports/2013/fta-1009---njrat-uncovered-1.pdf"}, {"index": 37, "title": "Proofpoint Staff. (2016, August 25). Nightmare on Tor Street: Ursnif variant Dreambot adds Tor functionality. Retrieved June 5, 2019.", "external_link": "https://www.proofpoint.com/us/threat-insight/post/ursnif-variant-dreambot-adds-tor-functionality"}, {"index": 38, "title": "Unit 42. (2017, December 15). Unit 42 Playbook Viewer. Retrieved December 20, 2017.", "external_link": "https://pan-unit42.github.io/playbook_viewer/"}, {"index": 39, "title": "Kaplan, D, et al. (2017, June 7). PLATINUM continues to evolve, find ways to maintain invisibility. Retrieved February 19, 2018.", "external_link": "https://cloudblogs.microsoft.com/microsoftsecure/2017/06/07/platinum-continues-to-evolve-find-ways-to-maintain-invisibility/?source=mmpc"}, {"index": 40, "title": "FireEye. (2018, February 20). APT37 (Reaper): The Overlooked North Korean Actor. Retrieved March 1, 2018.", "external_link": "https://www2.fireeye.com/rs/848-DID-242/images/rpt_APT37.pdf"}, {"index": 41, "title": "Dahan, A. (2017). Operation Cobalt Kitty. Retrieved December 27, 2018.", "external_link": "https://cdn2.hubspot.net/hubfs/3354902/Cybereason%20Labs%20Analysis%20Operation%20Cobalt%20Kitty.pdf"}, {"index": 42, "title": "Dumont, R. (2019, March 20). Fake or Fake: Keeping up with OceanLotus decoys. Retrieved April 1, 2019.", "external_link": "https://www.welivesecurity.com/2019/03/20/fake-or-fake-keeping-up-with-oceanlotus-decoys/"}, {"index": 43, "title": "Dumont, R.. (2019, April 9). OceanLotus: macOS malware update. Retrieved April 15, 2019.", "external_link": "https://www.welivesecurity.com/2019/04/09/oceanlotus-macos-malware-update/"}], "related": [{"link": "https://attack.mitre.org/groups/G0050", "Name": "APT32", "Description": "APT32 uses Cobalt Strike's malleable C2 functionality to blend in with network traffic. The group's backdoor can also exfiltrate data by encoding it in the subdomain field of DNS packets. Additionally, one of the group's macOS backdoors implements a specific format for the C2 packet involving random values.[24][3][41][42][43]"}, {"link": "https://attack.mitre.org/groups/G0067", "Name": "APT37", "Description": "APT37 credential stealer ZUMKONG emails credentials from the victim using HTTP POST requests.[40]"}, {"link": "https://attack.mitre.org/software/S0017", "Name": "BISCUIT", "Description": "BISCUIT communicates to the C2 server using a custom protocol.[32]"}, {"link": "https://attack.mitre.org/software/S0030", "Name": "Carbanak", "Description": "Carbanak uses a custom binary protocol for C2 communications.[31]"}, {"link": "https://attack.mitre.org/software/S0220", "Name": "Chaos", "Description": "Chaos provides a reverse shell connection on 8338/TCP, encrypted via AES.[16]"}, {"link": "https://attack.mitre.org/software/S0154", "Name": "Cobalt Strike", "Description": "Cobalt Strike allows adversaries to modify the way the \"beacon\" payload communicates. This is called \"Malleable C2\" in the Cobalt Strike manual and is intended to allow a penetration test team to mimic known APT C2 methods.[2][3]"}, {"link": "https://attack.mitre.org/software/S0115", "Name": "Crimson", "Description": "Crimson uses a custom TCP protocol for C2.[26]"}, {"link": "https://attack.mitre.org/software/S0255", "Name": "DDKONG", "Description": "DDKONG communicates over raw TCP.[6]"}, {"link": "https://attack.mitre.org/software/S0021", "Name": "Derusbi", "Description": "Derusbi binds to a raw socket on a random source port between 31800 and 31900 for C2.[22]"}, {"link": "https://attack.mitre.org/software/S0200", "Name": "Dipsind", "Description": "A Dipsind variant uses a C2 mechanism similar to port knocking that allows attackers to connect to a victim without leaving the connection open for more than a few sectonds.[4]"}, {"link": "https://attack.mitre.org/software/S0038", "Name": "Duqu", "Description": "Duqu is capable of using its command and control protocol over port 443. However, Duqu is also capable of encapsulating its command protocol over standard application layer protocols. The Duqu command and control protocol implements many of the same features as TCP and is a reliable transport protocol.[5]"}, {"link": "https://attack.mitre.org/software/S0367", "Name": "Emotet", "Description": "Emotet has been observed using an encrypted, modified protobuf-based protocol for command and control messaging.[33][34]"}, {"link": "https://attack.mitre.org/software/S0383", "Name": "FlawedGrace", "Description": "FlawedGrace uses a custom binary protocol for its C2 communications.[35]"}, {"link": "https://attack.mitre.org/software/S0260", "Name": "InvisiMole", "Description": "InvisiMole communicates with its C2 servers through a TCP socket.[17]"}, {"link": "https://attack.mitre.org/software/S0084", "Name": "Mis-Type", "Description": "Mis-Type network traffic can communicate over a raw socket.[20]"}, {"link": "https://attack.mitre.org/software/S0083", "Name": "Misdat", "Description": "Misdat network traffic communicates over a raw socket.[20]"}, {"link": "https://attack.mitre.org/software/S0149", "Name": "MoonWind", "Description": "MoonWind completes network communication via raw sockets.[12]"}, {"link": "https://attack.mitre.org/software/S0205", "Name": "Naid", "Description": "Naid connects to C2 infrastructure and establishes backdoors over a custom communications protocol.[8][9]"}, {"link": "https://attack.mitre.org/software/S0034", "Name": "NETEAGLE", "Description": "If NETEAGLE does not detect a proxy configured on the infected machine, it will send beacons via UDP/6000. Also, after retrieving a C2 IP address and Port Number, NETEAGLE will initiate a TCP connection to this socket. The ensuing connection is a plaintext C2 channel in which commands are specified by DWORDs.[25]"}, {"link": "https://attack.mitre.org/software/S0385", "Name": "njRAT", "Description": "njRAT communicates to the C2 server using a custom protocol over TCP.[36]"}, {"link": "https://attack.mitre.org/groups/G0049", "Name": "OilRig", "Description": "OilRig has used custom DNS Tunneling protocols for C2.[38]"}, {"link": "https://attack.mitre.org/software/S0158", "Name": "PHOREAL", "Description": "PHOREAL communicates via ICMP for C2.[24]"}, {"link": "https://attack.mitre.org/software/S0254", "Name": "PLAINTEE", "Description": "PLAINTEE uses a custom UDP protocol to communicate.[6]"}, {"link": "https://attack.mitre.org/groups/G0068", "Name": "PLATINUM", "Description": "PLATINUM has used the Intel\u00ae Active Management Technology (AMT) Serial-over-LAN (SOL) channel for command and control.[39]"}, {"link": "https://attack.mitre.org/software/S0013", "Name": "PlugX", "Description": "PlugX can be configured to use raw TCP or UDP for command and control.[28]"}, {"link": "https://attack.mitre.org/software/S0172", "Name": "Reaver", "Description": "Some Reaver variants use raw TCP for C2.[18]"}, {"link": "https://attack.mitre.org/software/S0153", "Name": "RedLeaves", "Description": "RedLeaves can communicate to its C2 over TCP using a custom binary protocol.[7]"}, {"link": "https://attack.mitre.org/software/S0019", "Name": "Regin", "Description": "The Regin malware platform can use ICMP to communicate between infected computers.[23]"}, {"link": "https://attack.mitre.org/software/S0125", "Name": "Remsec", "Description": "Remsec is capable of using ICMP, TCP, and UDP for C2.[13][14]"}, {"link": "https://attack.mitre.org/software/S0270", "Name": "RogueRobin", "Description": "RogueRobin uses a custom DNS tunneling protocol for C2.[29][30]"}, {"link": "https://attack.mitre.org/software/S0148", "Name": "RTM", "Description": "RTM uses HTTP POST requests with data formatted using a custom protocol.[27]"}, {"link": "https://attack.mitre.org/software/S0345", "Name": "Seasalt", "Description": "Seasalt uses a custom binary protocol for C2.[32]"}, {"link": "https://attack.mitre.org/software/S0263", "Name": "TYPEFRAME", "Description": "A TYPEFRAME variant uses fake TLS to communicate with the C2 server.[21]"}, {"link": "https://attack.mitre.org/software/S0333", "Name": "UBoatRAT", "Description": "UBoatRAT has used a custom command and control protocol to communicate with C2. The string \u2018488\u2019 is placed at the top of the payload and encrypts the entre buffer with a static key using a simple XOR cipher.[15]"}, {"link": "https://attack.mitre.org/software/S0386", "Name": "Ursnif", "Description": "Ursnif has used a custom packet format over TCP and UDP for a peer-to-peer (P2P) network for C2.[37]"}, {"link": "https://attack.mitre.org/software/S0180", "Name": "Volgmer", "Description": "Volgmer uses a custom binary protocol to beacon back to its C2 server. It has also used XOR for encrypting communications.[10][11]"}, {"link": "https://attack.mitre.org/software/S0155", "Name": "WINDSHIELD", "Description": "WINDSHIELD C2 traffic can communicate via TCP raw sockets.[24]"}, {"link": "https://attack.mitre.org/software/S0251", "Name": "Zebrocy", "Description": "Zebrocy uses raw sockets to communicate with its C2 server.[19]"}, {"Mitigation": "Filter Network Traffic", "Description": "Filter network traffic to look for unusual or non-standard protocols."}, {"Mitigation": "Network Intrusion Prevention", "Description": "Network intrusion detection and prevention systems that use network signatures to identify traffic for specific adversary malware can be used to mitigate activity at the network level. Signatures are often for unique indicators within protocols and may be based on the specific protocol used by a particular adversary or tool, and will likely be different across various malware families and versions. Adversaries will likely change tool C2 signatures over time or construct protocols in such a way as to avoid detection by common defensive tools.[1]"}, {"Mitigation": "Network Segmentation", "Description": "Properly configure firewalls and proxies to limit outgoing traffic to only necessary ports and through proper network gateway systems. Also ensure hosts are only provisioned to communicate over authorized interfaces."}]}